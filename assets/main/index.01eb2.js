window.__require=function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var l="function"==typeof __require&&__require;if(!s&&l)return l(c,!0);if(i)return i(c,!0);throw new Error("Cannot find module '"+a+"'")}a=c}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return r(t[a][1][e]||e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof __require&&__require,a=0;a<o.length;a++)r(o[a]);return r}({UIManager:[function(e,t,n){"use strict";cc._RF.push(t,"edcc5R2QtFJB5lU95+eHR2B","UIManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./boardManager"),s=e("../eventListener"),c=e("../state/gameState"),l=e("../types/events"),u=e("../types/booster"),d=cc._decorator,f=d.ccclass,p=d.property,E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.movesLabel=null,t.scoreLabel=null,t.gameLostLabel=null,t.gameWonLabel=null,t.teleportQuantityLabel=null,t.bombQuantityLabel=null,t.updateUI=function(){t.updateMoves(),t.updateScore(),t.updateTeleportQuantity(),t.updateBombQuantity()},t.updateMoves=function(){t.movesLabel.string=String(c.GameState.instance.moves)},t.updateScore=function(){t.scoreLabel.string=c.GameState.instance.score+"/"+c.GameState.instance.maxScore},t.onGameWon=function(){t.node.getChildByName("Board").getComponent(a.default).disableBoard(),t.disableUI(),t.gameWonLabel.node.setSiblingIndex(1e3),t.gameWonLabel.node.active=!0},t.onGameLost=function(){t.node.getChildByName("Board").getComponent(a.default).disableBoard(),t.disableUI(),t.gameLostLabel.node.setSiblingIndex(1e3),t.gameLostLabel.node.active=!0},t.updateTeleportQuantity=function(){t.teleportQuantityLabel.string=String(c.GameState.instance.boosterQuantities[u.EBooster.TELEPORT])},t.updateBombQuantity=function(){t.bombQuantityLabel.string=String(c.GameState.instance.boosterQuantities[u.EBooster.BOMB])},t.disableUI=function(){t.disableUIElement("MovesAndScore"),t.disableUIElement("BoosterLabel"),t.disableUIElement("Teleport"),t.disableUIElement("Bomb")},t.disableUIElement=function(e){var n=t.node.getChildByName(e);cc.tween().target(n).to(.3,{opacity:50}).start()},t.enableUI=function(){t.enableUIElement("MovesAndScore"),t.enableUIElement("BoosterLabel"),t.enableUIElement("Teleport"),t.enableUIElement("Bomb")},t.enableUIElement=function(e){var n=t.node.getChildByName(e);cc.tween().target(n).to(.3,{opacity:255}).start()},t}return r(t,e),t.prototype.start=function(){this.updateUI(),s.eventListener.on(l.EGameEvent.MOVES_UPDATED,this.updateMoves),s.eventListener.on(l.EGameEvent.SCORE_UPDATED,this.updateScore),s.eventListener.on(l.EGameEvent.GAME_WON,this.onGameWon),s.eventListener.on(l.EGameEvent.GAME_LOST,this.onGameLost),s.eventListener.on(l.EGameEvent.BOMB_QUANTITY_UPDATED,this.updateBombQuantity),s.eventListener.on(l.EGameEvent.TELEPORT_QUANTITY_UPDATED,this.updateTeleportQuantity),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this)},t.prototype.onDestroy=function(){s.eventListener.off(l.EGameEvent.MOVES_UPDATED,this.updateMoves),s.eventListener.off(l.EGameEvent.SCORE_UPDATED,this.updateScore),s.eventListener.off(l.EGameEvent.GAME_WON,this.onGameWon),s.eventListener.off(l.EGameEvent.GAME_LOST,this.onGameLost),s.eventListener.off(l.EGameEvent.BOMB_QUANTITY_UPDATED,this.updateBombQuantity),s.eventListener.off(l.EGameEvent.TELEPORT_QUANTITY_UPDATED,this.updateTeleportQuantity),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this)},t.prototype.onTouchStart=function(){c.GameState.instance.isPlayed&&this.restartGame()},t.prototype.restartGame=function(){c.GameState.restartGame(),this.gameWonLabel.node.active=!1,this.gameLostLabel.node.active=!1,this.enableUI(),this.updateUI()},i([p(cc.Label)],t.prototype,"movesLabel",void 0),i([p(cc.Label)],t.prototype,"scoreLabel",void 0),i([p(cc.Label)],t.prototype,"gameLostLabel",void 0),i([p(cc.Label)],t.prototype,"gameWonLabel",void 0),i([p(cc.Label)],t.prototype,"teleportQuantityLabel",void 0),i([p(cc.Label)],t.prototype,"bombQuantityLabel",void 0),i([f("UIManager")],t)}(cc.Component);n.default=E,cc._RF.pop()},{"../eventListener":"eventListener","../state/gameState":"gameState","../types/booster":"booster","../types/events":"events","./boardManager":"boardManager"}],boardManager:[function(e,t,n){"use strict";cc._RF.push(t,"10a7bI/erdGzrPBYxaDm6yD","boardManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../nodeControllers/cellController"),s=e("../eventListener"),c=e("../types/events"),l=e("../configs/layoutConfig"),u=cc._decorator,d=u.ccclass,f=u.property,p=l.layoutConfig.boardPaddingHorizontal,E=l.layoutConfig.boardPaddingVertical,m=l.layoutConfig.cellWidth,v=l.layoutConfig.cellHeight,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.cellPrefab=null,t.onCellsDestroyed=function(e){var n=[];e.forEach(function(e){var o=e.rowIndex,r=e.columnIndex,i=t.node.children.find(function(e){return"Cell"===e.name&&e.rowIndex===o&&e.columnIndex===r});n.push(i.getComponent(a.default).destroyNode())}),Promise.all(n).then(function(){s.eventListener.emit(c.EGameEvent.CELLS_DESTROYED_COMPLETED)})},t.onCellsFall=function(e){var n=[];e.forEach(function(e){var o=e.start,r=e.end,i=t.node.children.find(function(e){return"Cell"===e.name&&e.rowIndex===o.rowIndex&&e.columnIndex===o.columnIndex});n.push(i.getComponent(a.default).moveTo(r.rowIndex,r.columnIndex))}),Promise.all(n).then(function(){s.eventListener.emit(c.EGameEvent.CELLS_FALL_COMPLETED)})},t.onCellsGetNew=function(e){var n=[];e.sort(function(e,t){return e.rowIndex-t.rowIndex}).forEach(function(e){var o=e.rowIndex,r=e.columnIndex,i=e.color,s=cc.instantiate(t.cellPrefab);s.getComponent(a.default).setCellColor(i),s.getComponent(a.default).setCellSize(m,v),s.setPosition(-t.node.width/2+p+m/2+m*r,-t.node.height/2+E+v/2+v*o),s.attr({rowIndex:o,columnIndex:r}),s.opacity=0,s.scale=0,s.setParent(t.node),n.push(s.getComponent(a.default).appear())}),Promise.all(n).then(function(){s.eventListener.emit(c.EGameEvent.CELLS_GET_NEW_COMPLETED)})},t.onCellsDestroyFailed=function(e){var n=e.rowIndex,o=e.columnIndex;t.node.children.find(function(e){return"Cell"===e.name&&e.rowIndex===n&&e.columnIndex===o}).getComponent(a.default).shake().then(function(){s.eventListener.emit(c.EGameEvent.CELLS_DESTROY_FAILED_COMPLETED)})},t.onCellSelected=function(e){var n=e.rowIndex,o=e.columnIndex;t.node.children.find(function(e){return"Cell"===e.name&&e.rowIndex===n&&e.columnIndex===o}).getComponent(a.default).select(n,o).then(function(){return s.eventListener.emit(c.EGameEvent.CELL_SELECTED_DESELECTED_COMPLETED)})},t.onCellDeselected=function(e){var n=e.rowIndex,o=e.columnIndex;t.node.children.find(function(e){return"Cell"===e.name&&e.rowIndex===n&&e.columnIndex===o}).getComponent(a.default).deselect(n,o).then(function(){return s.eventListener.emit(c.EGameEvent.CELL_SELECTED_DESELECTED_COMPLETED)})},t.onCellsUseTeleport=function(e){var n=[],o=t.node.children.find(function(t){return"Cell"===t.name&&t.rowIndex===e[0].rowIndex&&t.columnIndex===e[0].columnIndex}),r=t.node.children.find(function(t){return"Cell"===t.name&&t.rowIndex===e[1].rowIndex&&t.columnIndex===e[1].columnIndex}),i=o.getComponent(a.default),l=r.getComponent(a.default);n.push(i.moveTo(e[1].rowIndex,e[1].columnIndex).then(function(){return i.deselect(e[1].rowIndex,e[1].columnIndex)})),n.push(l.moveTo(e[0].rowIndex,e[0].columnIndex).then(function(){return l.deselect(e[0].rowIndex,e[0].columnIndex)})),Promise.all(n).then(function(){s.eventListener.emit(c.EGameEvent.CELLS_USE_TELEPORT_COMPLETED)})},t}return r(t,e),t.prototype.start=function(){s.eventListener.on(c.EGameEvent.CELLS_DESTROYED,this.onCellsDestroyed),s.eventListener.on(c.EGameEvent.CELLS_FALL,this.onCellsFall),s.eventListener.on(c.EGameEvent.CELLS_GET_NEW,this.onCellsGetNew),s.eventListener.on(c.EGameEvent.CELLS_DESTROY_FAILED,this.onCellsDestroyFailed),s.eventListener.on(c.EGameEvent.CELL_SELECTED,this.onCellSelected),s.eventListener.on(c.EGameEvent.CELL_DESELECTED,this.onCellDeselected),s.eventListener.on(c.EGameEvent.CELLS_USE_TELEPORT,this.onCellsUseTeleport)},t.prototype.onDestroy=function(){s.eventListener.off(c.EGameEvent.CELLS_DESTROYED,this.onCellsDestroyed),s.eventListener.off(c.EGameEvent.CELLS_FALL,this.onCellsFall),s.eventListener.off(c.EGameEvent.CELLS_GET_NEW,this.onCellsGetNew),s.eventListener.off(c.EGameEvent.CELLS_DESTROY_FAILED,this.onCellsDestroyFailed),s.eventListener.off(c.EGameEvent.CELL_SELECTED,this.onCellSelected),s.eventListener.off(c.EGameEvent.CELL_DESELECTED,this.onCellDeselected),s.eventListener.off(c.EGameEvent.CELLS_USE_TELEPORT,this.onCellsUseTeleport)},t.prototype.paintBoard=function(e){var t=this;this.node.width=2*p+m*e.numberOfColumns,this.node.height=2*E+v*e.numberOfRows,this.node.setPosition(0,l.layoutConfig.boardPositionY-this.node.height/2);var n=[];return e.cells.forEach(function(e,o){e.forEach(function(e,r){var i=cc.instantiate(t.cellPrefab);i.getComponent(a.default).setCellColor(e.color),i.getComponent(a.default).setCellSize(m,v),i.setPosition(-t.node.width/2+p+m/2+m*r,-t.node.height/2+E+v/2+v*o),i.attr({rowIndex:o,columnIndex:r}),i.opacity=0,i.scale=0,i.setParent(t.node),n.push(i.getComponent(a.default).appear())})}),Promise.all(n)},t.prototype.disableBoard=function(){cc.tween().target(this.node).to(.3,{opacity:50}).start()},i([f(cc.Prefab)],t.prototype,"cellPrefab",void 0),i([d("BoardManager")],t)}(cc.Component);n.default=h,cc._RF.pop()},{"../configs/layoutConfig":"layoutConfig","../eventListener":"eventListener","../nodeControllers/cellController":"cellController","../types/events":"events"}],boardState:[function(e,t,n){"use strict";cc._RF.push(t,"18399DOINlPXKfs7Sll+XgD","boardState");var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.BoardState=void 0;var i=e("../configs/gameConfig"),a=e("../eventListener"),s=e("../types/events"),c=e("./cellState"),l=cc._decorator.ccclass,u=function(){function e(e,n,o){for(this._cells=[],this._gameState=e,this._numberOfRows=n,this._numberOfColumns=o;!this._cells||t.isNoSameColorAdjacentCells(this._cells);)this._cells=Array.from({length:n}).map(function(){return Array.from({length:o}).map(function(){return new c.CellState})})}var t;return t=e,Object.defineProperty(e.prototype,"gameState",{get:function(){return this._gameState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberOfRows",{get:function(){return this._numberOfRows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"numberOfColumns",{get:function(){return this._numberOfColumns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!1,configurable:!0}),e.prototype.destroySameColorCells=function(e,n){var o=t.getSameColorAdjacentCells(this._cells,e,n);1!==o.length?this.destroyCells(o):a.eventListener.emit(s.EGameEvent.CELLS_DESTROY_FAILED,{rowIndex:e,columnIndex:n})},e.prototype.destroyCells=function(e,t){var n=this;void 0===t&&(t=!0),t&&this._gameState.decreaseMoves(),this._gameState.addScore(e.length,t),e.forEach(function(e){var t=e.rowIndex,o=e.columnIndex;n._cells[t][o]=void 0}),a.eventListener.emit(s.EGameEvent.CELLS_DESTROYED,e)},e.prototype.fallCells=function(){var e=this,n=[];t.processFallingCells({cells:this._cells,numberOfRows:this.numberOfRows,numberOfColumns:this.numberOfColumns},function(t){var o=t.start,r=t.end;e._cells[r.rowIndex][r.columnIndex]=e._cells[o.rowIndex][o.columnIndex],e._cells[o.rowIndex][o.columnIndex]=void 0,n.push({start:o,end:r})}),a.eventListener.emit(s.EGameEvent.CELLS_FALL,n)},e.prototype.getNewCells=function(){var e=this,n=t.getEmptyCells(this._cells,this.numberOfRows,this.numberOfColumns);n.forEach(function(t){var n=t.rowIndex,o=t.columnIndex;e._cells[n][o]=new c.CellState}),a.eventListener.emit(s.EGameEvent.CELLS_GET_NEW,n.map(function(t){return o(o({},t),{color:e._cells[t.rowIndex][t.columnIndex].color})}))},e.prototype.checkGameStatus=function(){this._gameState.score>=this._gameState.maxScore?(this._gameState.isPlayed=!0,a.eventListener.emit(s.EGameEvent.GAME_WON)):0===this._gameState.moves?(a.eventListener.emit(s.EGameEvent.GAME_LOST),this._gameState.isPlayed=!0):t.isNoSameColorAdjacentCells(this._cells)&&(a.eventListener.emit(s.EGameEvent.GAME_LOST),this._gameState.isPlayed=!0)},e.prototype.useBomb=function(e,n){var o=t.getAllCellInRadius(this._cells,e,n,i.gameConfig.bombRadius);this._gameState.decreaseBombQuantity(),this.destroyCells(o,!1)},e.prototype.useTeleport=function(e){var t;t=[this._cells[e[1].rowIndex][e[1].columnIndex],this._cells[e[0].rowIndex][e[0].columnIndex]],this._cells[e[0].rowIndex][e[0].columnIndex]=t[0],this._cells[e[1].rowIndex][e[1].columnIndex]=t[1],this._gameState.decreaseTeleportQuantity(),a.eventListener.emit(s.EGameEvent.CELLS_USE_TELEPORT,e)},t=r([l("BoardState")],e)}();n.BoardState=u,function(e){e.getSameColorAdjacentCells=function(e,t,n){var o,r=[{rowIndex:t,columnIndex:n}],i=((o={})[t+","+n]=!0,o),a=function(t,n){[[1,0],[-1,0],[0,1],[0,-1]].forEach(function(o){var s,c=o[0],l=o[1],u=t+c,d=n+l;if(!i[u+","+d]){var f=null===(s=e[u])||void 0===s?void 0:s[d];(null==f?void 0:f.color)===e[t][n].color&&(r.push({rowIndex:u,columnIndex:d}),i[u+","+d]=!0,a(u,d))}})};return a(t,n),r},e.processFallingCells=function(e,t){for(var n=e.cells,o=e.numberOfRows,r=e.numberOfColumns,i=function(e){for(var r,i=[],a=0;a<o;a++)n[a][e]?void 0!==r&&i.push({rowIndex:a,columnIndex:e}):void 0===r&&(r=a);i.forEach(function(e){var n=e.rowIndex,o=e.columnIndex;t({start:{rowIndex:n,columnIndex:o},end:{rowIndex:r,columnIndex:o}}),r++})},a=0;a<r;a++)i(a)},e.getEmptyCells=function(e,t,n){for(var o=[],r=0;r<n;r++)for(var i=t-1;i>=0&&!e[i][r];i--)o.push({rowIndex:i,columnIndex:r});return o},e.isNoSameColorAdjacentCells=function(e){for(var t,n,o,r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++){var a=e[r][i].color,s=null===(n=null===(t=e[r+1])||void 0===t?void 0:t[i])||void 0===n?void 0:n.color,c=null===(o=e[r][i+1])||void 0===o?void 0:o.color;if(a===s||a===c)return!1}return!0},e.getAllCellInRadius=function(e,t,n,o){for(var r=[],i=Math.max(0,t-o);i<=Math.min(e.length-1,t+o);i++)for(var a=Math.max(0,n-o);a<=Math.min(e[t].length-1,n+o);a++)r.push({rowIndex:i,columnIndex:a});return r}}(u=n.BoardState||(n.BoardState={})),n.BoardState=u,cc._RF.pop()},{"../configs/gameConfig":"gameConfig","../eventListener":"eventListener","../types/events":"events","./cellState":"cellState"}],boosterController:[function(e,t,n){"use strict";cc._RF.push(t,"d2bc9DAKZpCP5GfSlT0HRgS","boosterController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=cc._decorator.ccclass,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTouchStart=function(){},t}return r(t,e),t.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart)},t.prototype.press=function(){cc.tween().target(this.node).to(.15,{scale:1.2}).start()},t.prototype.unpress=function(){cc.tween().target(this.node).to(.15,{scale:1}).start()},i([a("BoosterController")],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],booster:[function(e,t,n){"use strict";var o;cc._RF.push(t,"0398bj03fxGnbSOmNVmmplz","booster"),Object.defineProperty(n,"__esModule",{value:!0}),n.convertBoosterNodeName=n.BOOSTER_NODE_NAMES=n.EBooster=void 0,function(e){e.TELEPORT="teleport",e.BOMB="bomb"}(o=n.EBooster||(n.EBooster={})),n.BOOSTER_NODE_NAMES=["Teleport","Bomb"],n.convertBoosterNodeName=function(e){switch(e){case"Teleport":return o.TELEPORT;case"Bomb":return o.BOMB}},cc._RF.pop()},{}],cellController:[function(e,t,n){"use strict";cc._RF.push(t,"e39fdPPxLBFlonQpDBQAOnY","cellController");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../configs/gameConfig"),s=e("../types/cell"),c=cc._decorator.ccclass,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTouchStart=function(){},t}return r(t,e),t.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart)},t.prototype.setCellColor=function(e){switch(e){case s.ECellColor.RED:this.node.getChildByName("Red").active=!0;break;case s.ECellColor.GREEN:this.node.getChildByName("Green").active=!0;break;case s.ECellColor.BLUE:this.node.getChildByName("Blue").active=!0;break;case s.ECellColor.YELLOW:this.node.getChildByName("Yellow").active=!0;break;case s.ECellColor.PURPLE:this.node.getChildByName("Purple").active=!0}},t.prototype.setCellSize=function(e,t){this.node.width=e,this.node.height=t},t.prototype.destroyNode=function(){var e=this;return new Promise(function(t){cc.tween().target(e.node).to(.3,{scale:0,opacity:0}).call(function(){return e.node.destroy()}).call(function(){return t()}).start()})},t.prototype.moveTo=function(e,t){var n=this;return new Promise(function(o){var r=n.node.rowIndex,i=n.node.columnIndex;n.node.attr({rowIndex:e,columnIndex:t}),n.node.position.x,n.node.position.y,cc.tween().target(n.node).to(.2,{position:new cc.Vec2(n.node.position.x-(i-t)*n.node.width,n.node.position.y-(r-e)*n.node.height)}).call(function(){return o()}).start()})},t.prototype.appear=function(){var e=this;return new Promise(function(t){cc.tween().target(e.node).to(.3,{scale:1,opacity:255}).call(function(){return t()}).start()})},t.prototype.shake=function(){var e=this;return new Promise(function(t){var n=e.node.getSiblingIndex();e.node.setSiblingIndex(1e4);for(var o=cc.tween().target(e.node),r=0;r<5;r++)o=o.to(.1,{angle:r%2?10:-10,scale:1.1});o.to(.1,{angle:0,scale:1}).call(function(){return e.node.setSiblingIndex(n)}).call(function(){return t()}).start()})},t.prototype.select=function(e,t){var n=this;return new Promise(function(o){n.node.setSiblingIndex(1e4+e*a.gameConfig.boardNumberOfRows+t),cc.tween().target(n.node).to(.3,{scale:1.2}).call(function(){return o()}).start()})},t.prototype.deselect=function(e,t){var n=this;return new Promise(function(o){cc.tween().target(n.node).to(.3,{scale:1}).call(function(){return n.node.setSiblingIndex(e*a.gameConfig.boardNumberOfRows+t)}).call(function(){return o()}).start()})},i([c("CellController")],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../configs/gameConfig":"gameConfig","../types/cell":"cell"}],cellState:[function(e,t,n){"use strict";cc._RF.push(t,"98319ADR55GzbCmSZccWGgX","cellState");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.CellState=void 0;var r=e("../configs/gameConfig"),i=e("../types/cell"),a=e("../utils/getRandomInt"),s=cc._decorator.ccclass,c=function(){function e(e){this._color=e||t.getRandomCellColor()}var t;return t=e,Object.defineProperty(e.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),t=o([s("CellState")],e)}();n.CellState=c,function(e){e.getRandomCellColor=function(){var e=Object.values(i.ECellColor);return e[a.getRandomInt(0,Math.min(e.length-1,r.gameConfig.numberOfColors-1))]}}(c=n.CellState||(n.CellState={})),n.CellState=c,cc._RF.pop()},{"../configs/gameConfig":"gameConfig","../types/cell":"cell","../utils/getRandomInt":"getRandomInt"}],cell:[function(e,t,n){"use strict";cc._RF.push(t,"c0255Hp3qJFJpAJC2hOz1xc","cell"),Object.defineProperty(n,"__esModule",{value:!0}),n.ECellColor=void 0,function(e){e.RED="red",e.GREEN="green",e.BLUE="blue",e.YELLOW="yellow",e.PURPLE="purple"}(n.ECellColor||(n.ECellColor={})),cc._RF.pop()},{}],eventListener:[function(e,t,n){"use strict";cc._RF.push(t,"b91c7UvnrpCraitDpHkvmEo","eventListener");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.eventListener=void 0;var r=cc._decorator.ccclass,i=function(){function e(){this.eventTarget=new cc.EventTarget}return e.prototype.emit=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.eventTarget.emit(e[0],e[1])},e.prototype.on=function(e,t){this.eventTarget.on(e,t)},e.prototype.off=function(e,t){this.eventTarget.off(e,t)},e.prototype.once=function(e,t){this.eventTarget.once(e,t)},o([r("EventListener")],e)}();n.eventListener=new i,cc._RF.pop()},{}],events:[function(e,t,n){"use strict";cc._RF.push(t,"ddaf99LKMlNo4/wClF1fmdt","events"),Object.defineProperty(n,"__esModule",{value:!0}),n.EGameEvent=void 0,function(e){e.CELLS_DESTROYED="cells-destroyed",e.CELLS_DESTROYED_COMPLETED="cells-destroyed-completed",e.CELLS_FALL="cells-fall",e.CELLS_FALL_COMPLETED="cells-fall-completed",e.CELLS_GET_NEW="cells-get-new",e.CELLS_GET_NEW_COMPLETED="cells-get-new-completed",e.CELLS_DESTROY_FAILED="cells-destroy-failed",e.CELLS_DESTROY_FAILED_COMPLETED="cells-destroy-failed-completed",e.GAME_WON="game-won",e.GAME_LOST="game-lost",e.MOVES_UPDATED="moves-updated",e.SCORE_UPDATED="score-updated",e.RESTART_GAME="restart-game",e.BOMB_QUANTITY_UPDATED="bomb-quantity-updated",e.TELEPORT_QUANTITY_UPDATED="teleport-quantity-updated",e.CELL_SELECTED="cell-selected",e.CELL_DESELECTED="cell-deselected",e.CELL_SELECTED_DESELECTED_COMPLETED="cell-selected-deselected-completed",e.CELLS_USE_TELEPORT="cells-use-teleport",e.CELLS_USE_TELEPORT_COMPLETED="cells-use-teleport-completed"}(n.EGameEvent||(n.EGameEvent={})),cc._RF.pop()},{}],gameConfig:[function(e,t,n){"use strict";cc._RF.push(t,"dff58i1+GhDbqlsDP8sSfIo","gameConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.gameConfig=void 0,n.gameConfig={startMoves:30,maxScore:500,boardNumberOfRows:9,boardNumberOfColumns:9,numberOfColors:5,teleportQuantity:5,bombQuantity:3,bombRadius:1},cc._RF.pop()},{}],gameManager:[function(e,t,n){"use strict";cc._RF.push(t,"38537MXZK5Mj7YRW1GcxlR8","gameManager");var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0});var a=e("./boardManager"),s=e("../eventListener"),c=e("../state/gameState"),l=e("../types/events"),u=e("../nodeControllers/boosterController"),d=e("../types/booster"),f=cc._decorator,p=f.ccclass,E=f.property,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.boardPrefab=null,t.boosterButtons=[],t.buttonPressed=null,t.selectedCells=[],t.onRestartGame=function(){t.node.getChildByName("Board").destroy(),t.paintBoard()},t.onBoosterButtonUsed=function(e){var n=t.boosterButtons.find(function(t){return d.convertBoosterNodeName(t.name)===e});t.buttonPressed=null,n.getComponent(u.default).unpress()},t}return r(t,e),t.prototype.start=function(){this.paintBoard(),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),s.eventListener.on(l.EGameEvent.RESTART_GAME,this.onRestartGame)},t.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),s.eventListener.off(l.EGameEvent.RESTART_GAME,this.onRestartGame)},t.prototype.paintBoard=function(){var e=this;this.node.pauseSystemEvents(!0);var t=cc.instantiate(this.boardPrefab);t.setParent(this.node),t.getComponent(a.default).paintBoard(c.GameState.instance.boardState).then(function(){return e.node.resumeSystemEvents(!0)})},t.prototype.onTouchStart=function(e){if(!c.GameState.instance.isPlayed)if("Cell"!==e.target.name)d.BOOSTER_NODE_NAMES.includes(e.target.name)&&this.onBoosterButtonTouchStart(d.convertBoosterNodeName(e.target.name));else{var t=e.target.rowIndex,n=e.target.columnIndex;this.onCellTouchStart(t,n)}},t.prototype.onCellTouchStart=function(e,t){var n=this;switch(this.buttonPressed){case d.EBooster.BOMB:this.node.pauseSystemEvents(!0),this.onBoosterButtonUsed(this.buttonPressed),this.useBomb(e,t).then(function(){return n.fallCells()}).then(function(){return n.getNewCells()}).then(function(){return c.GameState.instance.boardState.checkGameStatus()}).then(function(){return n.node.resumeSystemEvents(!0)});break;case d.EBooster.TELEPORT:this.node.pauseSystemEvents(!0),this.selectCell(e,t).then(function(){if(2===n.selectedCells.length)return n.onBoosterButtonUsed(n.buttonPressed),n.useTeleport().then(function(){return n.selectedCells=[]})}).then(function(){return n.node.resumeSystemEvents(!0)});break;default:this.node.pauseSystemEvents(!0),this.destroyCells(e,t).then(function(e){if(e)return n.fallCells().then(function(){return n.getNewCells()}).then(function(){return c.GameState.instance.boardState.checkGameStatus()})}).then(function(){return n.node.resumeSystemEvents(!0)})}},t.prototype.destroyCells=function(e,t){return new Promise(function(n){function o(){n(!0),s.eventListener.off(l.EGameEvent.CELLS_DESTROY_FAILED_COMPLETED,r)}function r(){n(!1),s.eventListener.off(l.EGameEvent.CELLS_DESTROYED_COMPLETED,o)}s.eventListener.once(l.EGameEvent.CELLS_DESTROYED_COMPLETED,o),s.eventListener.once(l.EGameEvent.CELLS_DESTROY_FAILED_COMPLETED,r),c.GameState.instance.boardState.destroySameColorCells(e,t)})},t.prototype.fallCells=function(){return new Promise(function(e){s.eventListener.once(l.EGameEvent.CELLS_FALL_COMPLETED,function(){return e()}),c.GameState.instance.boardState.fallCells()})},t.prototype.getNewCells=function(){return new Promise(function(e){s.eventListener.once(l.EGameEvent.CELLS_GET_NEW_COMPLETED,function(){return e()}),c.GameState.instance.boardState.getNewCells()})},t.prototype.onBoosterButtonTouchStart=function(e){if(!(c.GameState.instance.boosterQuantities[e]<=0)){var t=this.boosterButtons.find(function(t){return d.convertBoosterNodeName(t.name)===e});if(this.buttonPressed===e)return this.buttonPressed=null,void t.getComponent(u.default).unpress();this.buttonPressed||(t.getComponent(u.default).press(),this.buttonPressed=e)}},t.prototype.useBomb=function(e,t){return new Promise(function(n){s.eventListener.once(l.EGameEvent.CELLS_DESTROYED_COMPLETED,function(){return n()}),c.GameState.instance.boardState.useBomb(e,t)})},t.prototype.selectCell=function(e,t){var n=this;return new Promise(function(o){var r=n.selectedCells.findIndex(function(n){return n.rowIndex===e&&n.columnIndex===t});-1!==r?(n.selectedCells.splice(r,1),s.eventListener.emit(l.EGameEvent.CELL_DESELECTED,{rowIndex:e,columnIndex:t})):(n.selectedCells.push({rowIndex:e,columnIndex:t}),s.eventListener.emit(l.EGameEvent.CELL_SELECTED,{rowIndex:e,columnIndex:t})),s.eventListener.on(l.EGameEvent.CELL_SELECTED_DESELECTED_COMPLETED,function(){return o()})})},t.prototype.useTeleport=function(){var e=this;return new Promise(function(t){s.eventListener.once(l.EGameEvent.CELLS_USE_TELEPORT_COMPLETED,function(){return t()}),c.GameState.instance.boardState.useTeleport(e.selectedCells)})},i([E(cc.Prefab)],t.prototype,"boardPrefab",void 0),i([E([cc.Node])],t.prototype,"boosterButtons",void 0),i([p("GameManager")],t)}(cc.Component);n.default=m,cc._RF.pop()},{"../eventListener":"eventListener","../nodeControllers/boosterController":"boosterController","../state/gameState":"gameState","../types/booster":"booster","../types/events":"events","./boardManager":"boardManager"}],gameState:[function(e,t,n){"use strict";cc._RF.push(t,"9dbe3XYbl1AKqKC23Ov9h6O","gameState");var o=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(n,"__esModule",{value:!0}),n.GameState=void 0;var r=e("../configs/gameConfig"),i=e("../eventListener"),a=e("../types/booster"),s=e("../types/events"),c=e("../utils/getLimitedNumber"),l=e("./boardState"),u=cc._decorator.ccclass,d=function(){function e(){var e;this._isPlayed=!1,this._score=0,this._boosterQuantities=((e={})[a.EBooster.BOMB]=0,e[a.EBooster.TELEPORT]=0,e),this._boardState=new l.BoardState(this,r.gameConfig.boardNumberOfRows,r.gameConfig.boardNumberOfColumns),this._moves=r.gameConfig.startMoves,this._maxScore=r.gameConfig.maxScore,this._boosterQuantities[a.EBooster.TELEPORT]=r.gameConfig.teleportQuantity,this._boosterQuantities[a.EBooster.BOMB]=r.gameConfig.bombQuantity}var t;return t=e,Object.defineProperty(e.prototype,"isPlayed",{get:function(){return this._isPlayed},set:function(e){this._isPlayed=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moves",{get:function(){return this._moves},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxScore",{get:function(){return this._maxScore},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boosterQuantities",{get:function(){return this._boosterQuantities},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"boardState",{get:function(){return this._boardState},enumerable:!1,configurable:!0}),Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),e.prototype.decreaseMoves=function(){this._moves--,i.eventListener.emit(s.EGameEvent.MOVES_UPDATED)},e.prototype.addScore=function(e,t){if(void 0===t&&(t=!0),t){for(var n=0,o=1;o<=e;o++)n+=1/(2.2-.4*(c.getLimitedNumber(r.gameConfig.numberOfColors,2,5)-2))+Math.max(0,r.gameConfig.numberOfColors-2)*o/2.2;this._score+=Math.floor(n)}else this._score+=e;i.eventListener.emit(s.EGameEvent.SCORE_UPDATED)},e.restartGame=function(){this._instance=null,i.eventListener.emit(s.EGameEvent.RESTART_GAME)},e.prototype.decreaseBombQuantity=function(){this._boosterQuantities[a.EBooster.BOMB]--,i.eventListener.emit(s.EGameEvent.BOMB_QUANTITY_UPDATED)},e.prototype.decreaseTeleportQuantity=function(){this._boosterQuantities[a.EBooster.TELEPORT]--,i.eventListener.emit(s.EGameEvent.TELEPORT_QUANTITY_UPDATED)},e._instance=null,t=o([u("GameState")],e)}();n.GameState=d,cc._RF.pop()},{"../configs/gameConfig":"gameConfig","../eventListener":"eventListener","../types/booster":"booster","../types/events":"events","../utils/getLimitedNumber":"getLimitedNumber","./boardState":"boardState"}],getLimitedNumber:[function(e,t,n){"use strict";cc._RF.push(t,"fe613XbpjBHAacxuZ2Zv0mk","getLimitedNumber"),Object.defineProperty(n,"__esModule",{value:!0}),n.getLimitedNumber=void 0,n.getLimitedNumber=function(e,t,n){return Math.max(t,Math.min(n,e))},cc._RF.pop()},{}],getRandomInt:[function(e,t,n){"use strict";cc._RF.push(t,"f0314Tpq2tGxai7kFSYNpZb","getRandomInt"),Object.defineProperty(n,"__esModule",{value:!0}),n.getRandomInt=void 0,n.getRandomInt=function e(t,n,o){void 0===o&&(o=[]),t=Math.ceil(t),n=Math.floor(n);var r=Math.floor(Math.random()*(n-t+1))+t;return o.includes(r)?e(t,n,o):r},cc._RF.pop()},{}],layoutConfig:[function(e,t,n){"use strict";cc._RF.push(t,"0ade7BFDAFP97Aa3bmCWeP2","layoutConfig"),Object.defineProperty(n,"__esModule",{value:!0}),n.layoutConfig=void 0,n.layoutConfig={boardPaddingHorizontal:41,boardPaddingVertical:70,cellWidth:100,cellHeight:100,boardPositionY:620},cc._RF.pop()},{}],ui:[function(e,t,n){"use strict";cc._RF.push(t,"8bd69A9LFJO/5ZPKLBeqoes","ui"),Object.defineProperty(n,"__esModule",{value:!0}),cc._RF.pop()},{}]},{},["gameConfig","layoutConfig","eventListener","UIManager","boardManager","gameManager","boosterController","cellController","boardState","cellState","gameState","booster","cell","events","ui","getLimitedNumber","getRandomInt"]);